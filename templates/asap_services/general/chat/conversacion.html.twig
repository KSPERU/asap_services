{% extends 'base.html.twig' %}

{% block stylesheets %}
  {{ encore_entry_link_tags('app') }}
  <link rel="stylesheet" href="{{ asset('css/proveedor/conversa_cliente.css') }}" />
{% endblock %}

{% block body %}
{# <div id="conversaciones"> #}
<style>
  .contboton-cerrar {
    font-size: 50px;
    font-weight: 700;
  }
  .contboton-cerrar a {
    color: #000;
    text-decoration: none;
  }
</style>

<div class="d-flex justify-content-center align-items-center h-100 w-100">
  <div class="container proveedor-conversa-cliente-container">
        <div class="d-flex flex-column justify-content-center align-items-center w-100">
          <div class="row d-flex justify-content-center align-items-start w-100 my-1">
            <div class="col-3 d-flex justify-content-center"></div>
            <div class="col-6 d-flex justify-content-center">{{ include('components/logo_pequenio.html.twig') }}</div>
            <div class="col-3 d-flex justify-content-center align-items-top contboton-cerrar">
            {% if is_granted('ROLE_PROV') %}
              {% set vista = path('app_asap_services_entornos_proveedor_inicio') %}
              {% set title = 'conversa con tu cliente' %}
            {% elseif is_granted('ROLE_CLI') %}
              {% set vista = path('app_asap_services_entornos_cliente_inicio') %}
              {% set title = 'conversa con tu proveedor' %}
            {% else %}
              <div>Hay un error</div>
            {% endif %}
              {# <a href={{vista}}>x</a> #}
              <a href={{vista}}>
                <svg xmlns="http://www.w3.org/2000/svg" height="25px" viewbox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"/></svg>
              </a>      
            </div>
          </div>
        </div>
        <div class="d-flex flex-column conversa-cliente-container">
            <h1 class="text-center conversa-cliente-title mb-4">{{title}}</h1>
            {% for cn in conversacion %}
            <a href="{{ path('app_chat', {'id': cn.conversationId}) }}" style="text-decoration:none">
            <div class="conversa-cliente-card d-flex">
                {# <div class="">
                    <img src="{{asset("image/ceci.png")}}" width="90px">
                </div> #}
                {% if cn.p_foto %}
                  <div class="">
                    <img src="{{ asset('img/' ~ cn.p_foto) }}" width="60" height="60" style="border-radius:50%">
                  </div>
                {% else %}
                  <div class="">
                    <img src="{{ asset('image/ceci.png') }}" width="50" height="50" style="border-radius:50%">
                  </div>
                {% endif %}
                <div class="d-flex ms-2 justify-content-center align-items-center w-100">
                    <div class="conversa-cliente-card-text">
                        <h5>{{cn.p_nombre}} {{cn.p_apellido}}<h5>
                        <span>{{cn.mensaje}}</span>
                    </div>
                    <div class="ms-1">
                        <a href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M88.2 309.1c9.8-18.3 6.8-40.8-7.5-55.8C59.4 230.9 48 204 48 176c0-63.5 63.8-128 160-128s160 64.5 160 128s-63.8 128-160 128c-13.1 0-25.8-1.3-37.8-3.6c-10.4-2-21.2-.6-30.7 4.2c-4.1 2.1-8.3 4.1-12.6 6c-16 7.2-32.9 13.5-49.9 18c2.8-4.6 5.4-9.1 7.9-13.6c1.1-1.9 2.2-3.9 3.2-5.9zM0 176c0 41.8 17.2 80.1 45.9 110.3c-.9 1.7-1.9 3.5-2.8 5.1c-10.3 18.4-22.3 36.5-36.6 52.1c-6.6 7-8.3 17.2-4.6 25.9C5.8 378.3 14.4 384 24 384c43 0 86.5-13.3 122.7-29.7c4.8-2.2 9.6-4.5 14.2-6.8c15.1 3 30.9 4.5 47.1 4.5c114.9 0 208-78.8 208-176S322.9 0 208 0S0 78.8 0 176zM432 480c16.2 0 31.9-1.6 47.1-4.5c4.6 2.3 9.4 4.6 14.2 6.8C529.5 498.7 573 512 616 512c9.6 0 18.2-5.7 22-14.5c3.8-8.8 2-19-4.6-25.9c-14.2-15.6-26.2-33.7-36.6-52.1c-.9-1.7-1.9-3.4-2.8-5.1C622.8 384.1 640 345.8 640 304c0-94.4-87.9-171.5-198.2-175.8c4.1 15.2 6.2 31.2 6.2 47.8l0 .6c87.2 6.7 144 67.5 144 127.4c0 28-11.4 54.9-32.7 77.2c-14.3 15-17.3 37.6-7.5 55.8c1.1 2 2.2 4 3.2 5.9c2.5 4.5 5.2 9 7.9 13.6c-17-4.5-33.9-10.7-49.9-18c-4.3-1.9-8.5-3.9-12.6-6c-9.5-4.8-20.3-6.2-30.7-4.2c-12.1 2.4-24.7 3.6-37.8 3.6c-61.7 0-110-26.5-136.8-62.3c-16 5.4-32.8 9.4-50 11.8C279 439.8 350 480 432 480z"/></svg></a>
                    </div>
                </div>
            </div>
          </a>
          <br>
          {% else %}
            <li>No hay conversaciones</li>
            <br>
          {% endfor %}
        </div>
  </div>
</div>

  {# <li>
      <strong>
        {{cn.mensaje}}
      </strong>
      |||
      <strong>
          {{cn.email}}
      </strong>
      |||
      <strong>
      <a href="{{ path('app_chat', {'id': cn.conversationId}) }}">ver Chat</a>
      </strong>
      <strong>
        {{ cn.fecha_creacion|date('d/m/y H:i:s') }}
      </strong>
  </li> #}

{# </div>
{# <div id="messages" {{ turbo_stream_listen('/chat/conversacion') }}>

                {{ include('asap_services/general/chat/turbo/_conversacionList.html.twig') }}
      
</div> #}


{% endblock %}
{% block javascripts %}
  {# <script>
    const eventSource = new EventSource("{{ mercure('https://example.com/conversacion/{id}')|escape('js') }}");
    eventSource.onmessage = event => {
      const data = JSON.parse(event.data);
        const mensajeElement = document.getElementById(`message-${data.conversationId}`);
          if (mensajeElement) {
              mensajeElement.innerHTML = data.uMensaje;
          }
    }
  </script> #}
{% endblock %}